# Leggi il messaggio del commit dal file
commit_message=$(cat "$1")

# Definisci le eccezioni per messaggi generati automaticamente
# Messaggi che iniziano con questi pattern sono considerati validi
exceptions_regex='^(Merge |Revert |Squash |Initial commit|fixup!|squash!|Amend |Auto-generated |Automated |GitHub Actions:|Dependabot:|Co-authored-by:|Signed-off-by:)'

# Regex principale per i commit manuali
commit_regex='^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,50}'

# Controlla prima se il commit Ã¨ un'eccezione
if echo "$commit_message" | grep -qE "$exceptions_regex"; then
    echo "âœ… Automated commit message detected - validation skipped"
    exit 0
fi

# Se non Ã¨ un'eccezione, applica la validazione normale
if ! echo "$commit_message" | grep -qE "$commit_regex"; then
    echo ""
    echo "ğŸš« COMMIT MESSAGE FORMAT ERROR!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "âŒ Your commit message does not follow the required format."
    echo ""
    echo "ğŸ“ REQUIRED FORMAT:"
    echo "   type(scope): description"
    echo ""
    echo "ğŸ·ï¸  ALLOWED TYPES:"
    echo "   â€¢ feat     - A new feature"
    echo "   â€¢ fix      - A bug fix"
    echo "   â€¢ docs     - Documentation changes"
    echo "   â€¢ style    - Code style changes (formatting, etc.)"
    echo "   â€¢ refactor - Code refactoring"
    echo "   â€¢ test     - Adding or updating tests"
    echo "   â€¢ chore    - Maintenance tasks"
    echo ""
    echo "âœ… VALID EXAMPLES:"
    echo "   feat(auth): add login functionality"
    echo "   fix: resolve navigation bug in sidebar"
    echo "   docs: update API documentation"
    echo "   refactor(ui): simplify button component"
    echo "   test: add unit tests for user service"
    echo "   chore: update dependencies"
    echo ""
    echo "ğŸ“ RULES:"
    echo "   â€¢ Description must be 1-50 characters"
    echo "   â€¢ Use lowercase for type and description"
    echo "   â€¢ Scope is optional but recommended"
    echo ""
    echo "ğŸ¤– AUTOMATIC EXEMPTIONS:"
    echo "   These commit patterns are automatically allowed:"
    echo "   â€¢ Merge commits (Merge branch...)"
    echo "   â€¢ Revert commits (Revert \"...\")"
    echo "   â€¢ Squash commits (Squash...)"
    echo "   â€¢ Initial repository setup"
    echo "   â€¢ GitHub Actions and Dependabot"
    echo "   â€¢ Co-authored commits"
    echo ""
    echo "ğŸ”„ TO FIX: Edit your commit message and try again"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    exit 1
fi

echo "âœ… Commit message format is valid!"
